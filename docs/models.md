# Models

Have you ever wondered how time consuming and sometimes how hard is to declare a simple table
with SQL Alchemy where sometimes it can also be combersome?

What about the Django interface type for tables? Cleaner right? Well, **Saffier** although is on
the top of SQL Alchemy core, it provides a Django like experience when it comes to create models.

## What is a model

A model in Saffier is a python class with attributes that represents a database table.

In other words, it is what represents your SQL table in your codebase.

## Declaring models

When declaring models by simply inheriting from `saffier.Model` object and define the attributes
using the saffier [Fields](./fields.md).

For each model defined you also need to set **one** mandatory field, the `registry` which is also
an instance of `Registry` from Saffier.

There are more parameters you can use and pass into the model such as [tablename](#metaclass) and
a few more but more on this in this document.

Since **Saffier** took inspiration from the interface of Django, that also means that a `Meta`
class should be declare.

```python
{!> ../docs_src/models/declaring_models.py !}
```

Although this looks very simple, in fact **Saffier** is doing a lot of work for you behind the
scenes.

Saffier models are a bit opinionated when it comes to `ID` and this is to maintain consistency
within the SQL tables with field names and lookups.

### Attention

If no `id` is declared in the model, **Saffier** will automatically generate an `id` of type
`BigIntegerField` and **automatically becoming the primary key**.

```python
{!> ../docs_src/models/declaring_models_no_id.py !}
```

### Restrictions with primary keys

Primary keys **should always** be declared in an `id` field. If you create a different
`primary_key` within the model in a different attribute, it will raise an `ImproperlyConfigured`.

**Primary keys must be always declared inside an ID attribute**.

Let us go through some examples.

#### What you should not do

The below examples are the practices **you should avoid** and it will raise an error. The examples
are applied to any [field](./fields.md) available in **Saffier**.

##### Declaring a model primary key different from ID

```python hl_lines="11"
{!> ../docs_src/models/declaring_models_pk_no_id.py !}
```

This will raise `ImproperlyConfigured` as you cannot have two primary keys.
One is the auto-generated `id` and the second is the `name`.

**You can only have one and it should always be called `id`**.

##### Declaring a model with ID and without default

When declaring an `id`, unless the field type is [IntegerField](./fields.md#integerfield) or
[BigIntegerField](./fields.md#bigintegerfield), you should always declare a `default` or a
`ValueError` is raised.

```python hl_lines="9"
{!> ../docs_src/models/pk_no_default.py !}
```

Since the deafult for a [CharField](./fields.md#charfield) is not provided, a `ValueError`
is raised.

#### What you should do

When it comes to primary keys, it is actually very simple and clean.

##### Declaring a model primary key with different field type

This is for an explicit `primary_key` that you don't want to be the default, for example, a
[UUIDField](./fields.md#uuidfield).

```python hl_lines="11"
{!> ../docs_src/models/pk_with_default.py !}
```

##### Declaring a model with default primary key

If you don't want to be bothered and you are happy with the defaults generated by **Saffier**,
then you can simply declare the model without the `id`.

```python
{!> ../docs_src/models/default_model.py !}
```

## The Meta class

When declaring a model, it is **crucial** having the `Meta` class declared. There is where you
declare the `metadata` needed for your models.

Currently the available parameters for the meta are:

* **registry** - The [registry](./registry.md) instance for where the model will be generated. This
field is **mandatory** and it will raise an `ImproperlyConfigured` error if no registry is found.

* **tablename** - The name of the table in the database, **not the class name**.

    <sup>Default: `name of class pluralised`<sup>

* **unique_together** - The unique constrainsts for your model.

    <sup>Default: `None`<sup>

* **abstract** - If the model is abstract or not. If is abstract, then it won't generate the
database table.

    <sup>Default: `False`<sup>

### Registry

Working with a [registry](./registry.md) is what makes **Saffier** dynamic and very flexible with
the familiar interface we all love. Without the registry, the model doesn't know where it should
get the data from. 

Imagine a `registry` like a bridge because it does exactly that.

Let us see some examples in how to use the registry with simple design and with some more complex
approaches.

#### In a nutshell

```python hl_lines="5 13"
{!> ../docs_src/models/registry/nutshell.py !}
```

As you can see, when declaring the `registry` and assigning it to `models`, that same `models` is
then used in the `Meta` of the model.

#### With inheritance

Yes, you can also use the model inheritance to help you out with your models and avoid repetition.

```python hl_lines="5 14"
{!> ../docs_src/models/registry/inheritance_no_repeat.py !}
```

As you can see, the `User` and `Product` tables are inheriting from the `BaseModel` where the
`registry` was already declared. This way you can avoid repeating yourself over and over again.

This can be particularly useful if you have more than one `registry` in your system and you want
to split the bases by responsabilities.

### With abstract classes

What if your class is abstract? Can you inherit the registry anyway? 

Of course! That doesn't change anything with the registry.

```python hl_lines="5 14"
{!> ../docs_src/models/registry/inheritance_abstract.py !}
```